{% extends "cms/base.html" %}
{% load cache cms_tags species_tags thumbnail %}

{% block scripts %}
{{ block.super }}
<!--
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"
        type="text/javascript"></script>
-->
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}js/jquery.jcarousel.min.js"></script>
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}js/jquery.jqplot.min.js"></script>
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}js/jqplot.barRenderer.min.js"></script>
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}js/jqplot.canvasTextRenderer.min.js"></script>
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}js/jqplot.canvasAxisLabelRenderer.min.js"></script>
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}js/jqplot.categoryAxisRenderer.min.js"></script>
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}colorbox/jquery.colorbox-min.js"></script>
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}js/jquery.tipTip.minified.js"></script>
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}slideshow/script.js"></script>
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}map/script.js"></script>
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}chart/script.js"></script>
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}data/script.js"></script>
<script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}similar_species/script.js"></script>

<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAACGFOAg3wAbbVTv66SFVQQxSYHLM1a-x6NXPXd7iQMKLtQ16USxRXBoJwXZQrS0JinK9yxAv9Gqry_g&sensor=false" type="text/javascript"></script>
<script src="http://gmaps-utility-library.googlecode.com/svn/trunk/markermanager/release/src/markermanager.js" type="text/javascript"></script>
{% endblock %}

{% block stylesheets %}
{{ block.super }}
<link rel="stylesheet" href="{{ MEDIA_URL }}css/jquery.jqplot.css" type="text/css">
<link rel="stylesheet" href="{{ MEDIA_URL }}css/jquery.tipTip.css" type="text/css">
<link rel="stylesheet" href="{{ MEDIA_URL }}colorbox/colorbox.css" type="text/css">
<link rel="stylesheet" href="{{ MEDIA_URL }}slideshow/style.css" type="text/css">
<link rel="stylesheet" href="{{ MEDIA_URL }}map/style.css" type="text/css">
<link rel="stylesheet" href="{{ MEDIA_URL }}chart/style.css" type="text/css">
<link rel="stylesheet" href="{{ MEDIA_URL }}data/style.css" type="text/css">
<link rel="stylesheet" href="{{ MEDIA_URL }}similar_species/style.css" type="text/css">
<style type="text/css">
    .fs_title {
        margin-top: 10px;
        margin-left: 10px;
    }
    .padded {
        margin: 10px;
    }
</style>
{% endblock %}

{% block content %}
<!-- wikipage start -->
{% species_by_name current_page.get_title as species %}
<div class="row top">
    <div class="twelvecol last">
        <h2 class="fs_title"><em>{{ species.name }}</em> {% if species.authority %}{{ species.authority }}{% endif %}</h2>
        {% if species.common_name %}<h3 class="fs_title">{{ species.common_name }}</h3>{% endif %}
    </div>
</div>
<div id="fs_yui-g" class="row">
    <div class="sixcol">
        <div class="all-images all-images-no-js">
        {% cache 0 species_images species.name %}
        <div id="images">
        {% for species_image in species.speciesimage_set.all %}
            {% if forloop.first %}
                <div class="current-image">
                    {% thumbnail species_image.image species_image.SIZES.medium as im %}
                        <a href="{{ species_image.image.url }}">
                            <img src="{{ im.url }}" />
                        </a>
                        <div id="slideshow-copyright">
                                {{ species_image.specimen_details|safe }}
                                {{ species_image.license_details|safe }}
                        </div>
                    {% endthumbnail %}
                </div>
                <ul class="other-images jcarousel-skin-tango">
            {% endif %}
            <li>
                {% thumbnail species_image.image species_image.SIZES.medium as medium %}
                    {% thumbnail species_image.image species_image.SIZES.thumbnail as small %}
                        <a href="{{ species_image.image.url }}" title="{{ species_image.specimen_details|safe }}{{ species_image.license_details|safe }}" class="thumbnail">
                            <img src="{{ small.url }}" />
                        </a>
                        <a href="{{ medium.url }}" class="hidden medium-thumbnail"></a>
                    {% endthumbnail %}
                {% endthumbnail %}
            </li>
            {% if forloop.last %}
                </ul>
            {% endif %}
        {% endfor %}
        </div>
        {% endcache %}

        {% if species.similar.all or request.user.is_staff %}
            {% cache 0 similar_species species.name %}
            <div id="similar">
            <h2>
                Similar Species
            {% if request.user.is_staff and species %}
                <span class="edit"><a href="{% url admin:species_species_change species.id %}" target="_new">edit</a></span>
            {% endif %}
            </h2>

            <ul class="other-images jcarousel-skin-tango">
            {% for similar_species in species.similar.all %}
                <li>
                <a href="{% page_url similar_species.factsheet %}" target="_blank">
                {% with similar_species.get_first_image as similar_image %}
                    {% thumbnail similar_image.image similar_image.SIZES.thumbnail as im %}
                        <img src="{{ im.url }}" title="{{ similar_image.title }}" /><br />
                    {% endthumbnail %}
                {% endwith %}
                     {{ similar_species }}
                </a>
                </li>
            {% endfor %}
            </ul>
          </div>
          {% endcache %}
      {% endif %}
      </div>
    </div>
    <div class="sixcol last">
        <div id="googlemap" class="googlemap">
            <span class="data">"species-data"</span>
            <div id="filters">
                <p class="right"><a href="" id="filters-close"><img src="http://maps.gstatic.com/intl/en_us/mapfiles/iw_close.gif" /></a></p>
                <p>
                    <form>
                        <input type="button" id="clear-filters" value="Clear filters" />
                        <input type="button" id="toggle-borders" value="Toggle borders" />
                    </form>
                </p>
            </div>
        </div>
        <div id="plot" class="chart tab">
            <span class="data">species-data</span>
            <span class="options"></span>
        </div>
    </div>
</div>

<div id="fs_content" class="row bottom">
    <div class="twelvecol last">
    <div class="padded">
    {% placeholder "factsheet" %}
    </div>
    </div>
</div>

<!-- data start -->
{% if species %}
    {% cache 0 js_data species.name %}
    <span class="dokuwiki-data" id="species-data">
    {% resource /data/api/speciesrecord/ format=json species__genus=species.genus species__species=species.species limit=0 %}
    </span>
    <span class="dokuwiki-data" id="state-data">
    {% resource /data/api/state/ format=json limit=0 %}
    </span>
    <span class="dokuwiki-data" id="county-data">
    {% resource /data/api/county/ format=json limit=0 %}
    </span>
    <span class="dokuwiki-data" id="collection-data">
    {% resource /data/api/collection/ format=json limit=0 %}
    </span>
    {% endcache %}
{% endif %}
<!-- data stop -->
{% endblock %}
